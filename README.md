
---

# Flow Log Parser

## Overview

This program parses a flow log file containing network flow data and maps each entry to a tag based on a lookup table. The lookup table is provided as a CSV file, with each row defining the destination port, protocol, and corresponding tag. The program outputs counts of matches for each tag and port/protocol combination.

## Assumptions

- The **flow log format** supported by the program is fixed, as specified in the default log format version 2. Other custom log formats are not supported.
- **Only flow log format version 2** is supported.
- The **protocols are represented by numbers** in the flow log (e.g., 6 for TCP, 17 for UDP), and these numbers are mapped to protocol names using an internal lookup (e.g., `6 -> tcp`, `17 -> udp`).
- The **lookup table** is provided in CSV format and contains three columns: `dstport`, `protocol`, and `tag`.
- **Tags can map to more than one port/protocol combination**, and the program matches based on both `dstport` and `protocol`.
- The program is case-insensitive when matching the protocol values from the flow log and lookup table.
- If no match is found for a flow log entry, it is categorized as "Untagged."

## How to Compile/Run the Program

### Prerequisites

- Python 3.x is required to run this program.
- No external dependencies or libraries are required beyond the standard Python library.

### Running the Program

1. **Place Your Flow Logs and Lookup Table**:
   - Ensure your flow log file (`flow_logs.txt`) and lookup table file (`lookup_table.csv`) are available in the same directory as the program.

2. **Run the Program**:
   To run the program, execute the following command from the terminal or command prompt:
   ```bash
   python flow_log_parser.py
   ```

3. **Output**:
   The program will generate an output file (`output.txt`) with two sections:
   - **Tag Counts**: A list of tags with their respective counts from the flow log entries.
   - **Port/Protocol Combination Counts**: A list of port and protocol combinations with their counts.

### Running Tests

The tests for the program are written using the `unittest` framework and are designed to verify the following:
- The **lookup table** is correctly loaded from the CSV file.
- The **flow logs** are correctly parsed, and the appropriate tags are applied based on the lookup table.
- The **output** generated by the program matches the expected output for predefined test cases.

To run the tests:

1. **Prepare the Test Files**:
   - Test files are located in the `tests` directory and include flow log files, lookup tables, and expected output files.

2. **Run the Tests**:
   You can run the tests using the following command:
   ```bash
   python -m unittest test_flow_log_parser.py
   ```

3. **Output**:
   The test will compare the generated output with the expected output and confirm whether the results are correct.

## Tests Performed

### Test Case 1
- **Flow Log File**: `flow_logs_test_1.txt`
- **Lookup Table**: `lookup_table_test_1.csv`
- **Expected Output**: `expected_output_test_1.txt`
  
### Test Case 2
- **Flow Log File**: `flow_logs_test_2.txt`
- **Lookup Table**: `lookup_table_test_2.csv`
- **Expected Output**: `expected_output_test_2.txt`

Each test case ensures that the flow log entries are parsed correctly, tags are applied as expected, and the final output matches the expected results.

## Directory Structure

```
/project
  ├── flow_log_parser.py       # Main program
  ├── test_flow_log_parser.py  # Test script
  ├── /tests
      ├── flow_logs_test_1.txt
      ├── flow_logs_test_2.txt
      ├── lookup_table_test_1.csv
      ├── lookup_table_test_2.csv
      ├── expected_output_test_1.txt
      ├── expected_output_test_2.txt
```

## Limitations

- The program only supports **default flow log format version 2**. Other versions or custom formats are not supported.
- Only **TCP, UDP, and other standard protocols** as defined in the `protocol_map` are supported.
- The program is designed to handle lookup tables with up to **10,000 entries** and flow log files up to **10 MB**.

## Code Analysis

- The program is structured in a way to allow easy extension, where additional protocol mappings or flow log formats could be added if required.
- The sorting of tags and port/protocol counts is done alphabetically, so the order of appearance in the flow log does not matter.
- The code includes basic error handling for file operations (e.g., missing files), but it does not cover more advanced error cases like malformed CSV or log files.
  
---
